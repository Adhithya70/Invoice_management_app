<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Invoice Details</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <h1>View Invoice Details</h1>

    <form id="invoiceDetailsForm">
        <label for="invoice_id">Invoice ID:</label>
        <input type="number" id="invoice_id" name="invoice_id" required><br><br>
        <button type="submit">View Details</button>
    </form>

    <div id="invoiceDetails"></div>

    <script>
        document.getElementById('invoiceDetailsForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const invoice_id = document.getElementById('invoice_id').value;

            const response = await fetch(`/viewInvoice/${invoice_id}`);
            const result = await response.json();

            if (result.invoice) {
                const invoice = result.invoice;
                const items = result.items;

                document.getElementById('invoiceDetails').innerHTML = `
                    <h2>Invoice ID: ${invoice.id}</h2>
                    <p><strong>Customer ID:</strong> ${invoice.customer_id}</p>
                    <p><strong>Invoice Date:</strong> ${invoice.invoice_date}</p>
                    <h3>Items:</h3>
                    <table border="1">
                        <thead>
                            <tr>
                                <th>Item ID</th>
                                <th>Item Name</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${items.map(item => `
                                <tr id="item-${item.id}">
                                    <td>${item.id}</td>
                                    <td>${item.item_name}</td>
                                    <td>${item.item_quantity}</td>
                                    <td>$${item.item_price}</td>
                                    <td><button onclick="deleteItem(${item.id})">Delete</button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } else {
                document.getElementById('invoiceDetails').innerHTML = `<p>Invoice not found.</p>`;
            }
        });

        async function deleteItem(itemId) {
            if (confirm('Are you sure you want to delete this item?')) {
                const response = await fetch(`/deleteItem/${itemId}`, { method: 'DELETE' });
                const result = await response.json();

                if (response.ok) {
                    alert(result.message);
                    document.getElementById(`item-${itemId}`).remove();
                } else {
                    alert('Error deleting item');
                }
            }
        }
    </script>
</body>
</html>
